<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="using:TorrentFlow"
        x:Class="TorrentFlow.MainWindow"
        Title="TorrentFlow"
        Width="960" Height="540"
        MinWidth="600" MinHeight="400"
        SizeToContent="Manual"
        x:DataType="local:MainWindow">

  <Window.Resources>
    <local:EmptyListVisibilityConverter x:Key="EmptyListVisibilityConverter"/>
    <local:InverseEmptyListVisibilityConverter x:Key="InverseEmptyListVisibilityConverter"/>
    <local:PauseButtonVisibilityConverter x:Key="PauseButtonVisibilityConverter"/>
    <local:ResumeButtonVisibilityConverter x:Key="ResumeButtonVisibilityConverter"/>
  </Window.Resources>

  <Grid Margin="10">
    <Grid.RowDefinitions>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <Border Grid.Row="0" BorderBrush="Gray" BorderThickness="1" Padding="5" Margin="5">
      <Grid>
        <DataGrid ItemsSource="{Binding Torrents}"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  GridLinesVisibility="All"
                  BorderThickness="1"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Stretch"
                  IsVisible="{Binding Torrents.Count, Converter={StaticResource InverseEmptyListVisibilityConverter}}"
                  CanUserResizeColumns="True">
          <DataGrid.Columns>
            <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*" CanUserResize="True"/>
            <DataGridTemplateColumn Header="Progress" Width="150" CanUserResize="True">
              <DataGridTemplateColumn.CellTemplate>
                <DataTemplate x:DataType="local:TorrentView">
                  <Grid HorizontalAlignment="Stretch" VerticalAlignment="Center">
                    <ProgressBar Value="{Binding Progress}" Maximum="100" Height="20"
                                 HorizontalAlignment="Stretch" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding Progress, StringFormat='{}{0:F2}%'}"
                               VerticalAlignment="Center" HorizontalAlignment="Center"
                               Foreground="White"/>
                  </Grid>
                </DataTemplate>
              </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>
            <DataGridTextColumn Header="Download Speed" Binding="{Binding DownloadSpeed}" Width="120" CanUserResize="True"/>
            <DataGridTextColumn Header="Upload Speed" Binding="{Binding UploadSpeed}" Width="120" CanUserResize="True"/>
            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100" CanUserResize="True"/>
            <DataGridTemplateColumn Header="Actions" Width="250" CanUserResize="True">
              <DataGridTemplateColumn.CellTemplate>
                <DataTemplate x:DataType="local:TorrentView">
                  <StackPanel Orientation="Horizontal" Spacing="5" HorizontalAlignment="Center">
                    <Button Content="Pause" CommandParameter="{Binding}" Click="PauseButton_Click"
                            IsVisible="{Binding Status, Converter={StaticResource PauseButtonVisibilityConverter}}"/>
                    <Button Content="Resume" CommandParameter="{Binding}" Click="ResumeButton_Click"
                            IsVisible="{Binding Status, Converter={StaticResource ResumeButtonVisibilityConverter}}"/>
                    <Button Content="Dir" CommandParameter="{Binding}" Click="OpenDirectoryButton_Click"/>
                    <Button Content="Del" CommandParameter="{Binding}" Click="DeleteButton_Click"/>
                  </StackPanel>
                </DataTemplate>
              </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>
          </DataGrid.Columns>
        </DataGrid>
        <TextBlock Text="No active torrents."
                   HorizontalAlignment="Center" VerticalAlignment="Center"
                   IsVisible="{Binding Torrents.Count, Converter={StaticResource EmptyListVisibilityConverter}}"/>
      </Grid>
    </Border>

    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
      <Button Content="Add Torrent" Click="AddTorrentButton_Click"
              Margin="0,0,10,0" Height="44" Width="120" FontSize="18"
              HorizontalContentAlignment="Center" VerticalContentAlignment="Center"/>
      <Button Click="SettingsButton_Click">
        <Image Source="Assets/settings_icon.ico" Width="32" Height="32"/>
      </Button>
    </StackPanel>
  </Grid>
</Window>